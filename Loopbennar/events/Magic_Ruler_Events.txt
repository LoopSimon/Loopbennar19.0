
namespace = magic_ruler

############################
### RANDOM POWERFUL MAGE ### These are all MTTH events
############################

country_event = { # Powerful Mage Heir
	id =  magic_ruler.103
	title =  magic_ruler.103.t
	desc =  magic_ruler.103.d
	picture = NEW_HEIR_eventPicture

	trigger = {
		OR = {
			ruler_is_powerful_mage = yes
			consort_is_powerful_mage = yes
		}
		has_government_attribute = heir
		NOT = { government = theocracy }
		has_heir = no
		has_regency = no
		is_lesser_in_union = no
		has_consort = yes

		ruler_is_not_immortal = yes
		NOT = { ruler_age = 60 }
		NOT = { has_country_flag = disabled_heir_events }

		has_not_banned_magic = yes
	}

	mean_time_to_happen = {
		months = 500
		modifier = {
			factor = 0.1
			has_global_flag = crimson_deluge
			is_year = 1560
			capital_scope = { superregion = escann_superregion }
		}
		modifier = {
			factor = 0.5
			has_reform = magical_elite_reform
		}
		modifier = {
			factor = 0.2
			AND = {
				ruler_is_powerful_mage = yes
				consort_is_powerful_mage = yes
			}
		}
	}

	option = {
		name = magic_ruler.103.a

		if = { limit = { ruler_is_harpy = yes }
			define_heir = {
				age = 0
				dynasty = ROOT
				female = yes
				hidden = yes
			}
		}
		else = {
			define_heir = {
				age = 0
				dynasty = ROOT
				hidden = yes
			}
		}
		define_powerful_mage = { type = heir }
	}
}

country_event = { # Powerful Mage Bastard - child
	id =  magic_ruler.104
	title =  magic_ruler.104.t
	desc =  magic_ruler.104.d
	picture = NEW_HEIR_eventPicture

	trigger = {
		OR = {
			ruler_is_powerful_mage = yes
			has_reform = magical_elite_reform
		}
		has_government_attribute = heir
		NOT = { government = theocracy }
		has_heir = yes
		heir_is_not_powerful_mage = yes
		heir_is_not_immortal = yes
		has_regency = no
		is_lesser_in_union = no

		NOT = { ruler_age = 60 }

		NOT = { ruler_has_personality = incorruptible_personality }
		NOT = { ruler_has_personality = kind_hearted_personality }

		NOT = { has_country_flag = disabled_heir_events }

		has_not_banned_magic = yes
	}

	mean_time_to_happen = {
		months = 1000
		modifier = {
			factor = 0.5
			has_reform = magical_elite_reform
		}
		modifier = {
			factor = 0.25
			ruler_is_powerful_mage = yes
		}
		modifier = {
			factor = 0.75
			OR = {
				ruler_has_personality = drunkard_personality
				ruler_has_personality = naive_personality
				ruler_has_personality = silver_tongue_personality
			}
		}
	}

	option = {
		name = magic_ruler.104.a
		ai_chance = {
			factor = 75
		}

		remove_heir = {  }

		reduce_legitimacy_large_effect = yes

		if = { limit = { ruler_is_harpy = yes }
			define_heir = {
				age = 16
				dynasty = ROOT
				no_consort_with_heir = yes
				female = yes
				hidden = yes
			}
		}
		else = {
			define_heir = {
				age = 16
				dynasty = ROOT
				no_consort_with_heir = yes
				hidden = yes
			}
		}
		define_powerful_mage = { type = heir }
	}

	option = {
		name = magic_ruler.104.b
		ai_chance = {
			factor = 25
		}

		increase_legitimacy_medium_effect = yes
	}
}

country_event = { # Young Heir turns to be a promising mage
	id =  magic_ruler.105
	title =  magic_ruler.105.t
	desc = {
		trigger = {
			OR = {
				NOT = { capital_scope = { superregion = escann_superregion } }
				NOT = { has_global_flag = crimson_deluge }
			}
		}
		desc =  magic_ruler.105.d
	}
	desc = {
		trigger = {
			capital_scope = { superregion = escann_superregion }
			has_global_flag = crimson_deluge
		}
		desc =  magic_ruler.105.da
	}
	picture = COMET_eventPicture

	trigger = {
		has_government_attribute = heir
		has_heir = yes
		heir_is_not_powerful_mage = yes
		NOT = { heir_age = 16 } #homunculi will never be this young

		has_not_banned_magic = yes
	}

	mean_time_to_happen = {
		months = 7300
		modifier = {
			factor = 0.01
			capital_scope = { superregion = escann_superregion }
			has_global_flag = crimson_deluge
			is_year = 1580
			NOT = { current_age = age_of_revolutions }
		}
		modifier = {
			factor = 0.2
			OR = {
				ruler_is_powerful_mage = yes
				consort_is_powerful_mage = yes
			}
		}
		modifier = {
			factor = 0.5
			has_reform = magical_elite_reform
		}
		modifier = {
			factor = 0.5
			current_age = age_of_absolutism
		}
		modifier = {
			factor = 0.9
			is_emperor_of_china = yes
			empire_of_china_reform_passed = taste_magic_reform
		}
	}

	option = {
		name = magic_ruler.105.a
		ai_chance = {
			factor = 90
			modifier = {
				factor = 100
				current_age = age_of_absolutism
			}
		}

		define_powerful_mage = { type = heir }
	}

	# floodborn
	option = {
		name = magic_ruler.105.b
		trigger = {
			capital_scope = { superregion = escann_superregion }
			has_global_flag = crimson_deluge
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				has_country_flag = banned_magic
			}
			modifier = {
				factor = 5
				current_age = age_of_revolutions
			}
		}

		remove_heir = {  }
	}

	# not floodborn
	option = {
		name = magic_ruler.105.c
		trigger = {
			OR = {
				NOT = { capital_scope = { superregion = escann_superregion } }
				NOT = { has_global_flag = crimson_deluge }
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				has_country_flag = banned_magic
			}
			modifier = {
				factor = 5
				current_age = age_of_revolutions
			}
		}

		remove_heir = {  }
	}
}

country_event = { #Powerful Mage Pretender - get a powerful mage ruler
	id =  magic_ruler.106
	title =  magic_ruler.106.t
	desc =  magic_ruler.106.d
	picture = CIVIL_WAR_eventPicture

	trigger = {
		has_reform = magical_elite_reform
		government = monarchy
		ruler_is_not_powerful_mage = yes
		OR = {
			overextension_percentage = 0.5
			NOT = { stability = 1 }
		}
		num_of_cities = 2
	}

	mean_time_to_happen = {
		months = 1500
		modifier = {
			factor = 0.75
			OR = {
				NOT = { adm = 3 }
				NOT = { dip = 3 }
				NOT = { mil = 3 }
			}
		}
	}

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					is_core = ROOT
					is_capital = no
				}
				save_event_target_as = magical_pretender_province
			}
		}
	}

	option = {
		name = magic_ruler.106.a
		goto = magical_pretender_province

		hidden_effect = { add_country_modifier = { name = wyvernheart_war_wizard_rebels_mod duration = 1 } }
		set_country_flag = mage_pretender_revolt
		event_target:magical_pretender_province = {
			spawn_rebels = {
				type = pretender_rebels
				religion = ROOT
				size = 2
				win = yes
			}
		}
		hidden_effect = { remove_country_modifier = wyvernheart_war_wizard_rebels_mod }
	}
}

##########################
### WAR MAGIC CASUALTY ###
##########################

country_event = { # War Magic Death - Early Game
	id =  magic_ruler.110
	title =  magic_ruler.110.t
	desc =  magic_ruler.110.d
	picture = COMET_SIGHTED_eventPicture

	trigger = {
		ruler_is_powerful_mage = yes
		NOT = { current_age = age_of_revolutions }
		is_at_war = yes
		has_cast_war_magic = yes
		ruler_is_not_immortal = yes
		NOT = { special_life_extension = yes }
	}

	mean_time_to_happen = {
		months = 730

		modifier = {
			factor = 1.25
			war_score = 10
		}
	}

	option = {	#Die
		name = magic_ruler.110.a

		kill_ruler = yes
	}

	option = {	#Abjuration 1
		name = magic_ruler.110.b
		trigger = { is_ruler_abjuration_level_1_minimum = yes }
		highlight = yes

		add_mil_power = -50

		random_list = {
			3 = {
				modifier = {
					factor = 1.67
					is_ruler_abjuration_level_2 = yes
				}
				modifier = {
					factor = 3
					is_ruler_abjuration_level_3 = yes
				}

			}
			1 = { kill_ruler = yes }
		}
	}
}

country_event = { # War Magic Death - Black Damestear
	id =  magic_ruler.111
	title =  magic_ruler.111.t
	desc =  magic_ruler.111.d
	picture = COMET_SIGHTED_eventPicture

	trigger = {
		ruler_is_powerful_mage = yes
		current_age = age_of_revolutions
		is_at_war = yes
		has_cast_war_magic = yes
		ruler_is_not_immortal = yes
		NOT = { special_life_extension = yes }
	}

	mean_time_to_happen = {
		months = 365

		modifier = {
			factor = 1.25
			war_score = 10
		}
	}

	option = {	#Die
		name = magic_ruler.111.a

		kill_ruler = yes
	}


	option = {	#Abjuration 3
		name = magic_ruler.111.b
		trigger = { is_ruler_abjuration_level_3 = yes }
		highlight = yes

		add_mil_power = -50

		random = {
			chance = 50
			kill_ruler = yes
		}
	}
}

##################
### WITCH-KING ###
##################

country_event = { #Rise of a Witch-King
	id =  magic_ruler.66
	title =  magic_ruler.66.t
	desc =  magic_ruler.66.desc
	picture = COMET_SIGHTED_eventPicture
	
	is_triggered_only = yes

	after = {
		hidden_effect = {
			country_event = { id = anbennar_setup.7 days = 1 } #setup evil opinion
			if = {
				limit = {
					NOT = { has_global_flag = imperial_witch_king_active }
					is_part_of_hre = yes
					is_emperor = no
					NOT = { emperor = { overlord_of = ROOT } }
				}
				save_global_event_target_as = imperial_witch_king
				set_global_flag = imperial_witch_king_active
				if = {
					limit = { has_dlc = "Emperor" }
					set_imperial_incident = incident_witch_prince
				}
				else = { emperor = { country_event = { id = magic_ruler.71 } } }
			}
			G91 = {
				country_event = {
					id = flavor_isobelin.23 #refugees from witch king
					days = 180
				}
			}
			#invite mages back, forces you out of artificery only mode
			if = {
				limit = { has_country_flag = magic_artificery_artificery_only }
				artifice_magic_switch_to_mixed_mode = yes
			}
		}
	}

	option = { #My Thorns Go Unnoticed
		name = magic_ruler.66.a
		ai_chance = { factor = 1 }
		
		set_country_flag = witch_king_thorns
		add_ruler_modifier = { name = witch_king_thorns_modifier duration = -1 }
		custom_tooltip = signature_spell_tt
		remove_country_modifier = illusion_0_invisibility_mod
		add_ruler_modifier = { name = illusion_0_invisibility_mod duration = -1 }
		custom_tooltip = witch_king_thorns_modifier_desc
	}

	option = { #My Armies are Endless
		name = magic_ruler.66.b
		ai_chance = { factor = 1 }
		trigger = { is_ruler_necromancy_level_1_minimum = yes }
		highlight = yes
		
		set_country_flag = witch_king_armies
		add_ruler_modifier = { name = witch_king_armies_modifier duration = -1 }
		custom_tooltip = signature_spell_tt
		remove_country_modifier = necromancy_1_steal_vitality_mod
		add_ruler_modifier = { name = necromancy_1_steal_vitality_mod duration = -1 }
		custom_tooltip = witch_king_armies_modifier_desc
	}

	option = { #My Will is Stronger
		name = magic_ruler.66.c
		ai_chance = { factor = 1 }
		trigger = { is_ruler_enchantment_level_2_minimum = yes }
		highlight = yes
		
		set_country_flag = witch_king_will
		add_ruler_modifier = { name = witch_king_will_modifier duration = -1 }
		custom_tooltip = signature_spell_tt
		remove_country_modifier = enchantment_2_mass_charm_2_mod
		add_ruler_modifier = { name = enchantment_2_mass_charm_2_mod duration = -1 }
		custom_tooltip = signature_spell_war_magic_tt
		set_ruler_flag = witch_king_war_magic
		make_spell_half_off = { school = enchantment level = 3 id = dominate_to_surrender ruler = yes }
	}

	option = { #My Skill Exceeds Yours
		name = magic_ruler.66.d
		ai_chance = { factor = 1 }
		trigger = { is_ruler_divination_level_2_minimum = yes }
		highlight = yes
		
		set_country_flag = witch_king_skill
		add_ruler_modifier = { name = witch_king_skill_modifier duration = -1 }
		custom_tooltip = signature_spell_tt
		remove_country_modifier = divination_2_manipulated_fortune_mod_buffed
		add_ruler_modifier = { name = divination_2_manipulated_fortune_mod_buffed duration = -1 }
		custom_tooltip = signature_spell_war_magic_tt
		set_ruler_flag = witch_king_war_magic
		custom_tooltip = witch_king_skill_modifier_desc
	}

	option = { #I Build From Ruin
		name = magic_ruler.66.e
		ai_chance = { factor = 1 }
		trigger = { is_ruler_transmutation_level_2_minimum = yes }
		highlight = yes
		
		set_country_flag = witch_king_build
		add_ruler_modifier = { name = witch_king_build_modifier duration = -1 }
		custom_tooltip = signature_spell_tt
		remove_country_modifier = transmutation_2_reshape_terrain_mod
		add_ruler_modifier = { name = transmutation_2_reshape_terrain_mod duration = -1 }
		make_spell_half_off = { school = evocation level = 2 id = meteor_swarm ruler = yes }
	}

	option = { #I Rise Above Others
		name = magic_ruler.66.f
		ai_chance = { factor = 1 }
		trigger = { is_ruler_abjuration_level_2_minimum = yes }
		highlight = yes
		
		set_country_flag = witch_king_rise
		add_ruler_modifier = { name = witch_king_rise_modifier duration = -1 }
		custom_tooltip = signature_spell_tt
		remove_country_modifier = abjuration_2_mage_armor_mod
		add_ruler_modifier = { name = abjuration_2_mage_armor_mod duration = -1 }
		custom_tooltip = signature_spell_war_magic_tt
		set_ruler_flag = witch_king_war_magic
		custom_tooltip = witch_king_rise_modifier_desc
	}

	option = { #I Annihilate My Adversaries
		name = magic_ruler.66.g
		ai_chance = { factor = 1 }
		trigger = { is_ruler_evocation_level_1_minimum = yes }
		highlight = yes
		
		set_country_flag = witch_king_annihilate
		add_ruler_modifier = { name = witch_king_annihilate_modifier duration = -1 }
		custom_tooltip = signature_spell_tt
		remove_country_modifier = evocation_1_shock_and_awe_mod
		add_ruler_modifier = { name = evocation_1_shock_and_awe_mod duration = -1 }
		custom_tooltip = witch_king_annihilate_modifier_desc
	}

	option = { #I Command Heaven and Earth
		name = magic_ruler.66.h
		ai_chance = { factor = 1 }
		trigger = { is_ruler_conjuration_level_2_minimum = yes }
		highlight = yes
		
		set_country_flag = witch_king_command
		add_ruler_modifier = { name = witch_king_command_modifier duration = -1 }
		custom_tooltip = signature_spell_tt
		remove_country_modifier = conjuration_2_aid_construction_mod
		add_ruler_modifier = { name = conjuration_2_aid_construction_mod duration = -1 }
		custom_tooltip = witch_king_command_modifier_desc
	}
}

country_event = { #Death of a Witch-King
	id = magic_ruler.67
	title = magic_ruler.67.t
	desc = magic_ruler.67.d
	picture = DEATH_OF_HEIR_eventPicture

	is_triggered_only = yes
	
	trigger = {
		ruler_is_witch_king = yes
		ruler_has_infamy_witch_king = no #they'll just ascend regular
		NOT = { ruler_is_immortal = yes } #Accounts for fake deaths
		NOT = { has_country_flag = Y26_sado_elected_once }
		NOT = { has_country_flag = nsc_ruler_will_come_back }	#nsc event that temporally exile your ruler should not trigger this
	}

	option = {
		name = magic_ruler.67.a
		ai_chance = { factor = 100 }
		trigger = {
			OR = {
				ruler_is_powerful_mage = yes
				has_ruler_flag = is_powerful_mage #Since this fires alongside magic_system.20
			}
		}
		highlight = yes
		
		become_a_witch_king_effect = yes
		
		add_country_modifier = {
			name = witch_king_death
			duration = 1825
		}
	}
	
	option = {
		name = magic_ruler.67.b
		ai_chance = { factor = 1 }
		
		add_country_modifier = {
			name = witch_king_death
			duration = 3650
		}
		
		clr_witch_king_country_flags = yes
		
		#Removes opinion malus
		hidden_effect = {
			country_event = { id = anbennar_setup.8 days = 1 }
		}
	}
}

country_event = { #Ruler Reforms
	id = magic_ruler.68
	title = magic_ruler.68.t
	desc = magic_ruler.68.desc
	picture = BANKRUPTCY_eventPicture

	is_triggered_only = yes
	trigger = {
		ruler_is_witch_king = yes
		ruler_has_infamy_witch_king = no
	}

	option = { #give peace a chance
		name = magic_ruler.68.a
		ai_chance = { factor = 1 }

		trigger_switch = {
			on_trigger = has_country_flag
			witch_king_thorns = {
				clr_country_flag = witch_king_thorns
				remove_country_modifier = witch_king_thorns_modifier
				remove_country_modifier = enchantment_2_enchanting_embassy_2_mod
			}
			witch_king_armies = {
				clr_country_flag = witch_king_armies
				remove_country_modifier = witch_king_armies_modifier
				remove_country_modifier = necromancy_1_steal_vitality_mod
			}
			witch_king_will = {
				clr_country_flag = witch_king_will
				remove_country_modifier = witch_king_will_modifier
				remove_country_modifier = enchantment_2_mass_charm_2_mod
				clr_ruler_flag = witch_king_war_magic
				clr_ruler_flag = enchantment_3_dominate_to_surrender_spell_half
			}
			witch_king_skill = {
				clr_country_flag = witch_king_skill
				remove_country_modifier = witch_king_skill_modifier
				remove_country_modifier = divination_2_manipulated_fortune_mod_buffed
				clr_ruler_flag = witch_king_war_magic
			}
			witch_king_build = {
				clr_country_flag = witch_king_build
				remove_country_modifier = witch_king_build_modifier
				remove_country_modifier = transmutation_2_reshape_terrain_mod
				clr_ruler_flag = evocation_2_meteor_swarm_spell_half
			}
			witch_king_rise = {
				clr_country_flag = witch_king_rise
				remove_country_modifier = witch_king_rise_modifier
				remove_country_modifier = abjuration_2_mage_armor_mod
				clr_ruler_flag = witch_king_war_magic
			}
		}
		clr_country_flag = ruled_by_witch_king
		add_country_modifier = { name = witch_king_a_new_hope duration = 3650 }

		calculate_magical_infamy_modifier = yes

		#Removes opinion malus
		hidden_effect = {
			country_event = { id = anbennar_setup.8 days = 1 }
		}
	}

	option = { #nah
		name = magic_ruler.68.b
		ai_chance = { factor = 1 }

		set_ruler_flag = 32_witch_king_points
	}
}
country_event = { #Evil Ruler Removed Through Peace Deal (Witch-King, Lich, Vampire, Infernal Court)
	id =  magic_ruler.69
	title =  magic_ruler.69.t
	desc =  magic_ruler.69.d
	picture = DEATH_OF_HEIR_eventPicture
	
	is_triggered_only = yes
	
	trigger = { is_evil = yes }
	
	immediate = {
		hidden_effect = {
			FROM = { country_event = { id = magic_ruler.70 } }
		}
	}
	
	option = {
		name = magic_ruler.69.a
		
		#Witch King Stuff
		if = {
			limit = { ruler_is_witch_king = yes }
			clr_witch_king_country_flags = yes

			#No more mages for Witch Kings
			if = {
				limit = { heir_is_powerful_mage = yes }
				exile_heir_as = exiled_evil_heir_@ROOT
			}
			add_country_modifier = {
				name = witch_king_death
				duration = 3650
			}
			
			#Removes opinion malus
			hidden_effect = {
				country_event = { id = anbennar_setup.8 days = 1 }
			}
		}

		#Lich Stuff
		kill_a_lich_effect = yes

		#Vampire stuff
		remove_vampire_immortality = yes
		clr_country_flag = vampire_heir
		clr_country_flag = has_exiled_vampire_heir

		#Infernalist stuff
		if = {
			limit = { religion = infernal_court }
			change_religion = FROM
		}

		#varamhar stuff
		if = {
			limit = { has_reform = varamhar_eternal_empire }
			if = {
				limit = { has_country_modifier = varamhar_phoenix_empire_restored }
				remove_government_reform = varamhar_eternal_empire
				remove_country_modifier = varamhar_phoenix_empire_restored
				add_government_reform = phoenix_empire
			}
			else = {
				remove_government_reform = varamhar_eternal_empire
				add_government_reform = phoenix_akalate
			}
		}
		if = {
			limit = { has_reform = varamhar_eternal_empire_mandate }
			if = {
				limit = { has_country_modifier = varamhar_phoenix_empire_restored }
				remove_government_reform = varamhar_eternal_empire_mandate
				remove_country_modifier = varamhar_phoenix_empire_restored
				add_government_reform = phoenix_empire_mandate
			}
			else = {
				remove_government_reform = varamhar_eternal_empire_mandate
				add_government_reform = phoenix_akalate
				add_government_reform = appease_khet
			}
		}
		
		exile_ruler_as = { name = exiled_evil_ruler_@ROOT }
		
		add_stability = -3
		add_prestige = -50
	}
}
country_event = { #Evil Ruler Removed Through Peacedeal
	id =  magic_ruler.70
	title =  magic_ruler.70.t
	desc =  magic_ruler.70.d
	picture = DEATH_OF_HEIR_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = magic_ruler.70.a
		
		add_country_modifier = {
			name = defeated_evil_ruler
			duration = 3650
		}

		add_karma = 20
		
		#Little bonus for the emperor for removing witch-princes
		if = {
			limit = {
				is_emperor = yes
				FROM = {
					is_part_of_hre = yes
				}
			}
			add_imperial_influence = 5
		}
	}
}

country_event = { #Imperial incident for removing Witch Princes, Emperor side
	id = magic_ruler.71
	title = magic_ruler.71.t
	desc = magic_ruler.71.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	major = yes
	
	after = { hidden_effect = { country_event = { id = magic_ruler.73 days = 2 } } } #clear flags
	
	option = { # They have forfeited their right to rule [target.GetName]
		name = magic_ruler.71.a
		ai_chance = {
			factor = 10
			modifier = {
				factor = 2
				OR = {
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_rivalry
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_hostile
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_threatened
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_outraged
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_rebellious
					}
				}
			}
		}

		emperor = {
			declare_war_with_cb = {
				who = event_target:imperial_witch_king
				casus_belli = cb_evil_ruler
			}
		}

		if = {
			limit = {
				NOT = {
					event_target:imperial_witch_king = { tag = A85 }
					war_with = A85
				}
				exists = A85
			}
			custom_tooltip = magisterium_may_join_war_tt
			hidden_effect = { A85 = { country_event = { id = magic_ruler.72 } } }
		}

		event_target:imperial_witch_king = { add_ruler_modifier = { name = denounced_witch_king duration = 3650 } }
	}
	
	option = { # Denounce them
		name = magic_ruler.71.b
		ai_chance = {
			factor = 5
			modifier = {
				factor = 2
				OR = {
					has_opinion = {
						who = event_target:imperial_witch_king
						value = 100
					}				
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_friendly
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_loyal
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_allied
					}
				}
			}
		}
		add_imperial_influence = -20
		add_ruler_modifier = { name = cowardly_emperor duration = -1 }

		event_target:imperial_witch_king = { add_ruler_modifier = { name = denounced_witch_king duration = 3650 } }
	}
}
country_event = { #Imperial incident for removing Witch-Princes, Magisterium
	id = magic_ruler.72
	title = magic_ruler.72.t
	desc = magic_ruler.72.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	trigger = { NOT = { war_with = emperor } has_saved_global_event_target = imperial_witch_king }
	
	option = { # We will join the emperor
		name = magic_ruler.72.a
		ai_chance = {
			factor = 10
			modifier = {
				factor = 2
				OR = {
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_rivalry
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_hostile
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_threatened
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_outraged
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_rebellious
					}
				}
			}
			modifier = {
				factor = 0.75
				is_at_war = yes
			}
		}
		join_all_offensive_wars_of = emperor
	}
	
	option = { # Denounce them
		name = magic_ruler.72.b
		ai_chance = {
			factor = 5
			modifier = {
				factor = 2
				OR = {
					has_opinion = {
						who = event_target:imperial_witch_king
						value = 100
					}				
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_friendly
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_loyal
					}
					ai_attitude = {
						who = event_target:imperial_witch_king
						attitude = attitude_allied
					}
				}
			}
		}
		add_ruler_modifier = {
			name = shirked_imperial_responsibility
			duration = -1
		}
	}
}
country_event = { #Clears the stuff later so the popups make sense
	id = magic_ruler.73
	title = magic_ruler.73.t
	desc = magic_ruler.73.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	hidden = yes
	is_triggered_only = yes
	
	option = {
		name = magic_ruler.73.a
		hidden_effect = {
			clr_global_flag = imperial_witch_king_active
			clear_global_event_target = imperial_witch_king
		}
	}
}

country_event = { #Witch-King becomes Black Doctrine
	id = magic_ruler.77
	title = magic_ruler.77.t
	desc = magic_ruler.77.d
	picture = BIG_BOOK_eventPicture

	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		current_age = age_of_absolutism
		ruler_is_witch_king = yes
		NOT = { religion = black_doctrine }
		NOT = { tag = F53 }
		NOT = { has_country_flag = supernaturally_bound_faith }
		num_of_cities = 1
	}

	option = {
		name = magic_ruler.77.a
		ai_chance = { factor = 1 }
		set_ruler_religion = black_doctrine
		change_religion = black_doctrine
		capital_scope = { change_religion = black_doctrine }
		add_country_modifier = {
			name = black_converting_zeal
			duration = 7300
		}
	}
	option = {
		name = magic_ruler.77.b
		ai_chance = { factor = 0 }
	}
}

province_event = { #delayed event for Black Doctrine to end the month tick
	id = magic_ruler.78
	title = magic_ruler.78.t
	desc = magic_ruler.78.d
	picture = BIG_BOOK_eventPicture

	hidden = yes
	is_triggered_only = yes

	trigger = {
		has_province_modifier = bd_illusory_conversion_helper
	}

	option = {
		name = magic_ruler.78
		add_province_modifier = {
			name = bd_illusory_conversion_unhelper
			duration = 1
			hidden = yes
		}
	}
}
